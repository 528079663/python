<html>
<head>
  <title>爱词霸 每日一词爬取</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600553 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="892"/>
<h1>爱词霸 每日一词爬取</h1>

<div>
<span><div><span style="color: rgb(56, 56, 56); font-family: gotham, helvetica, arial, sans-serif; font-size: 14px;">要爬取的目标网站是金山词霸的每日一句栏目</span></div><div><span style="font-size: 11pt; color: rgb(56, 56, 56); font-family: gotham;">本人热衷英语学习，同时觉得其使用的图片以后可以当做素材，作为一个什么限制也没有的基础网站，学习爬虫的初学者拿这个网站试手就很好。</span></div><div><span style="font-size: 11pt; color: rgb(56, 56, 56); font-family: gotham;">本次爬虫所要爬取的内容包括每日一句的英文，翻译，以及对应的图片。</span></div><div><span style="color: rgb(56, 56, 56); font-family: gotham, helvetica, arial, sans-serif; font-size: 14px;">创建工程</span><br/></div><div><span style="border: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(56, 56, 56); font-family: gotham, helvetica, arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">scrapy startproject iciba</span></div><div><span style="border: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(56, 56, 56); font-family: gotham, helvetica, arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">生成spider文件</span></div><div><span style="border: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(56, 56, 56); font-family: gotham, helvetica, arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">scrapy genspider</span> <span style="font-size: 11pt; color: rgb(56, 56, 56); font-family: gotham;">IcibaSpider </span><span style="font-size: 11pt; color: rgb(56, 56, 56); font-family: gotham;"><a href="http://news.iciba.com/views/dailysentence/daily.html#!/detail/title/2019-06-04">news.iciba.com/views/dailysentence/daily.html#!/detail/title/2019-06-04</a></span></div><div><br/></div><div><span style="border: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(56, 56, 56); font-family: gotham, helvetica, arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.57143em;">分析链接</span></div><div><a href="http://news.iciba.com/views/dailysentence/daily.html#!/detail/title/2019-06-04" style="font-size: 11pt; color: rgb(56, 56, 56); font-family: gotham;">http://news.iciba.com/views/dailysentence/daily.html#!/detail/title/2019-06-04</a></div><div>1.url分析 连接的开头是<a href="http://news.iciba.com/views/dailysentence/daily.html#!/detail/title/2019-06-04" style="font-size: 11pt; color: rgb(56, 56, 56); font-family: gotham;">http://news.iciba.com/views/dailysentence/daily.html#!/detail/title/</a> 后面加上YYYY-MM-DD格式的日期</div><div>2.网站内容分析 发现整个tab都在  <span style="min-width: 0px; min-height: 0px; box-sizing: border-box; color: rgb(34, 34, 34); text-decoration-line: none !important; unicode-bidi: -webkit-isolate; font-family: Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">class</span><span style="color: rgb(34, 34, 34); font-family: Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">=&quot;</span><span style="min-width: 0px; min-height: 0px; box-sizing: border-box; color: rgb(34, 34, 34); text-decoration-line: none !important; unicode-bidi: -webkit-isolate; font-family: Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">detail-content</span><span style="color: rgb(34, 34, 34); font-family: Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">&quot;的div下面</span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">打开cmd</span></div><div><span style="color: rgb(34, 34, 34); font-family: Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">使用scrapy shell</span> <a href="http://news.iciba.com/views/dailysentence/daily.html#!/detail/title/2019-06-04" style="font-size: 11pt; color: rgb(56, 56, 56); font-family: gotham;">http://news.iciba.com/views/dailysentence/daily.html#!/detail/title/2019-06-04</a></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">response.body.decode('utf8') 查看下整个页面的返回内容</span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">发现没有我们想要的数据。</span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">不服气啊，再看看标签</span><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">detail-content</span><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">下面的数据</span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">response.xpath('//div[@class=&quot;detail-content&quot;]').extract()</span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">一堆杂毛数据，确实没有我们想要的，换个思路。</span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">3.查看网页请求，按F12监控其network请求</span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">找找js下面的内容</span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">发现下面这个js携带了我们需要的数据</span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">index.php?callback=jQuery190013302076789326667_1559638506130&amp;c=dailysentence&amp;m=getTodaySentence&amp;_=1559638506134 HTTP/1.1</span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">赶紧搞出来看看</span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">把请求的url从head里面摘取出来，得到下面的链接</span></div><div><span style="color: rgb(34, 34, 34); font-family: Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a href="http://sentence.iciba.com/index.php?callback=jQuery190013302076789326667_1559638506130&amp;c=dailysentence&amp;m=getTodaySentence&amp;_=1559638506134">http://sentence.iciba.com/index.php?callback=jQuery190013302076789326667_1559638506130&amp;c=dailysentence&amp;m=getTodaySentence&amp;_=1559638506134</a></span></div><div>一脸懵逼，看不出来传参的规律。</div><div>不要急，再看看前一天的取数链接</div><div><span style="color: rgb(34, 34, 34); font-family: Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a href="http://sentence.iciba.com/index.php?callback=jQuery19009440094763792144_1559639303547&amp;c=dailysentence&amp;m=getdetail&amp;title=2019-06-03&amp;_=1559639303551">http://sentence.iciba.com/index.php?callback=jQuery19009440094763792144_1559639303547&amp;c=dailysentence&amp;m=getdetail&amp;title=2019-06-03&amp;_=1559639303551</a></span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">好像有那么点意思了哦，再看看前一天的</span></div><div><span style="color: rgb(34, 34, 34); font-family: Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a href="http://sentence.iciba.com/index.php?callback=jQuery19009440094763792144_1559639303547&amp;c=dailysentence&amp;m=getdetail&amp;title=2019-06-02&amp;_=1559639303554">http://sentence.iciba.com/index.php?callback=jQuery19009440094763792144_1559639303547&amp;c=dailysentence&amp;m=getdetail&amp;title=2019-06-02&amp;_=1559639303554</a></span></div><div>规律出来了哦，去掉多余的信息，即可得到我们所要访问的目标参数</div><div><a href="http://sentence.iciba.com/index.php?callback=jQuery19009440094763792144_1559639303547&amp;c=dailysentence&amp;m=getdetail&amp;title=2019-06-02&amp;_=1559639303554" style="color: rgb(34, 34, 34); font-family: Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">http://sentence.iciba.com/</a>?<a href="http://sentence.iciba.com/index.php?callback=jQuery19009440094763792144_1559639303547&amp;c=dailysentence&amp;m=getdetail&amp;title=2019-06-03&amp;_=1559639303551" style="color: rgb(34, 34, 34); font-family: Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">&amp;c=dailysentence&amp;m=getdetail&amp;title=2019-06-0</a>4</div><div><br/></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">我们再用</span><span style="color: rgb(34, 34, 34); font-family: Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">scrapy shell &quot;</span><a href="http://sentence.iciba.com/index.php?callback=jQuery19009440094763792144_1559639303547&amp;c=dailysentence&amp;m=getdetail&amp;title=2019-06-02&amp;_=1559639303554" style="color: rgb(34, 34, 34); font-family: Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">http://sentence.iciba.com/</a>?<a href="http://sentence.iciba.com/index.php?callback=jQuery19009440094763792144_1559639303547&amp;c=dailysentence&amp;m=getdetail&amp;title=2019-06-03&amp;_=1559639303551" style="color: rgb(34, 34, 34); font-family: Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">&amp;c=dailysentence&amp;m=getdetail&amp;title=2019-06-0</a>4&quot;</div><div>注意，这里的url要用双引号括起来</div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">再次使用命令response.body.decode('utf8')发现不能直接将转码的数据转成中文。</span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">再分析下返回的结果，发现是个json。那就使用json类来解析</span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">import json</span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">json.loads(response.body.decode('utf8'),encoding='utf-8')</span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;">搞定，返回了我们想要的结果。</span></div><div><span style="font-size: 9pt; color: rgb(34, 34, 34); font-family: Consolas;"><img src="爱词霸 每日一词爬取_files/Image.png" type="image/png" data-filename="Image.png"/></span></div><div><br/></div><div>可以看到，我们想要的内容对应的key值分别为content，last_title,note,picture2,translation，title</div><div>这里的图片的链接，我们可以直接访问一下，发现picture是小图，picture2是大图，因此我们选用这个值。</div><div>所有的分析工作已经做好了，下面就开始进入pycharm，完成我们的爬虫代码把。</div><div><br/></div><div>IcibaItem里定义好我们需要爬取的字段</div><div>content，last_title,note,picture2,translation，title</div><div><br/></div><div>修改IcibaspiderSpider里的起始url为<a href="http://sentence.iciba.com/?&amp;c=dailysentence&amp;m=getdetail&amp;title=2019-06-04">http://sentence.iciba.com/?&amp;c=dailysentence&amp;m=getdetail&amp;title=2019-06-04</a></div><div><br/></div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">class</span> IcibaspiderSpider(scrapy.Spider):</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">name = <span style="color: #6a8759;">'IcibaSpider'</span></div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #808080;"># allowed_domains = ['<a href="http://news.iciba.com/views/dailysentence/daily.html#!/detail/title/2019-06-04">news.iciba.com/views/dailysentence/daily.html#!/detail/title/2019-06-04</a>']</span></div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #808080;"># start_urls = ['<a href="http://news.iciba.com/views/dailysentence/daily.html#!/detail/title/2019-06-04/">http://news.iciba.com/views/dailysentence/daily.html#!/detail/title/2019-06-04/</a>']</span></div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><br/></div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">def</span> <span style="color: #ffc66d;">start_requests</span>(<span style="color: #94558d;">self</span>):</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">start_url = <span style="color: #6a8759;">'<a href="http://sentence.iciba.com/?&amp;c=dailysentence&amp;m=getdetail&amp;title=2017-12-31">http://sentence.iciba.com/?&amp;c=dailysentence&amp;m=getdetail&amp;title=2017-12-31</a>'</span></div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">yield</span> scrapy.Request(start_url<span style="color: #cc7832;">,</span> <span style="color: #aa4926;">callback</span>=<span style="color: #94558d;">self</span>.parse)</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><br/></div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">def</span> <span style="color: #ffc66d;">parse</span>(<span style="color: #94558d;">self</span><span style="color: #cc7832;">,</span> response):</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">items = IcibaItem()</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">json_obj = json.loads(response.body.decode(<span style="color: #6a8759;">'utf8'</span>)<span style="color: #cc7832;">,</span><span style="color: #aa4926;">encoding</span>=<span style="color: #6a8759;">'utf-8'</span>)</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">items[<span style="color: #6a8759;">'content'</span>] = json_obj.get(<span style="color: #6a8759;">'content'</span>)</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">items[<span style="color: #6a8759;">'last_title'</span>] = json_obj.get(<span style="color: #6a8759;">'last_title'</span>)</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">items[<span style="color: #6a8759;">'title'</span>] = json_obj.get(<span style="color: #6a8759;">'title'</span>)</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">items[<span style="color: #6a8759;">'note'</span>] = json_obj.get(<span style="color: #6a8759;">'note'</span>)</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">items[<span style="color: #6a8759;">'picture'</span>] = json_obj.get(<span style="color: #6a8759;">'picture2'</span>)</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">items[<span style="color: #6a8759;">'translation'</span>] = json_obj.get(<span style="color: #6a8759;">'translation'</span>)</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">last_title = items[<span style="color: #6a8759;">'last_title'</span>]</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">title = items[<span style="color: #6a8759;">'title'</span>]</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">next_url = <span style="color: #6a8759;">&quot;<a href="http://sentence.iciba.com/?&amp;c=dailysentence&amp;m=getdetail&amp;title=">http://sentence.iciba.com/?&amp;c=dailysentence&amp;m=getdetail&amp;title=</a>&quot;</span> + last_title</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">if</span> title ==<span style="color: #6a8759;">&quot;2015-06-01&quot;</span>:</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">pass</span></div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">else</span>:</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">yield</span> items</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">yield</span> scrapy.Request(<span style="color: #aa4926;">url</span>=next_url<span style="color: #cc7832;">,</span> <span style="color: #aa4926;">callback</span>=<span style="color: #94558d;">self</span>.parse)</div><div><br/></div><div>编写存文档的pipline和图片下载器</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">class</span> IcibaPipeline(<span style="color: #8888c6;">object</span>):</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #808080;"># 初始化创建文件的编码格式 名称 操作关键字 字符集</span></div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">def</span> <span style="color: #ffc66d;">process_item</span>(<span style="color: #94558d;">self</span><span style="color: #cc7832;">,</span> item<span style="color: #cc7832;">,</span> <span style="color: #808080;">spider</span>):</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">content = item[<span style="color: #6a8759;">'content'</span>]</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">title = item[<span style="color: #6a8759;">'title'</span>]</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">note = item[<span style="color: #6a8759;">'note'</span>]</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">translation = item[<span style="color: #6a8759;">'translation'</span>]</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">file = <span style="color: #8888c6;">open</span>(<span style="color: #6a8759;">'spider_result.txt'</span><span style="color: #cc7832;">,</span> <span style="color: #6a8759;">'a+'</span><span style="color: #cc7832;">,</span> <span style="color: #aa4926;">encoding</span>=<span style="color: #6a8759;">'utf-8'</span>)</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">file.write(<span style="color: #6a8759;">'title'</span> + title + <span style="color: #6a8759;">'</span><span style="color: #cc7832;">\n</span><span style="color: #6a8759;">'</span>)</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">file.write(<span style="color: #6a8759;">'content'</span> + content + <span style="color: #6a8759;">'</span><span style="color: #cc7832;">\n</span><span style="color: #6a8759;">'</span>)</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">file.write(<span style="color: #6a8759;">'note:'</span> + note + <span style="color: #6a8759;">'</span><span style="color: #cc7832;">\n</span><span style="color: #6a8759;">'</span>)</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">file.write(<span style="color: #6a8759;">'translation：'</span> + translation + <span style="color: #6a8759;">'</span><span style="color: #cc7832;">\n</span><span style="color: #6a8759;">'</span>)</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">return</span> item</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><br/></div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><br/></div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">class</span> MyImagesPipeline(ImagesPipeline):</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">IMAGES_STORE = get_project_settings().get(<span style="color: #6a8759;">'IMAGES_STORE'</span>)</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><br/></div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">def</span> <span style="color: #ffc66d;">get_media_requests</span>(<span style="color: #94558d;">self</span><span style="color: #cc7832;">,</span> item<span style="color: #cc7832;">,</span> info):</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">yield</span> Request(item[<span style="color: #6a8759;">'picture'</span>])</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><br/></div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">def</span> <span style="color: #ffc66d;">item_completed</span>(<span style="color: #94558d;">self</span><span style="color: #cc7832;">,</span> results<span style="color: #cc7832;">,</span> item<span style="color: #cc7832;">,</span> info):</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">image_paths = [x[<span style="color: #6a8759;">'path'</span>] <span style="color: #cc7832;">for</span> ok<span style="color: #cc7832;">,</span> x <span style="color: #cc7832;">in</span> results <span style="color: #cc7832;">if</span> ok]</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">if not</span> image_paths:</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">raise</span> DropItem(<span style="color: #6a8759;">&quot;Item contains no images&quot;</span>)</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;">os.rename(<span style="color: #94558d;">self</span>.IMAGES_STORE + <span style="color: #6a8759;">'</span><span style="color: #cc7832;">\\</span><span style="color: #6a8759;">'</span> + image_paths[<span style="color: #6897bb;">0</span>].replace(<span style="color: #6a8759;">'/'</span><span style="color: #cc7832;">,</span> <span style="color: #6a8759;">'</span><span style="color: #cc7832;">\\</span><span style="color: #6a8759;">'</span>)<span style="color: #cc7832;">,</span></div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #94558d;">self</span>.IMAGES_STORE + <span style="color: #6a8759;">'</span><span style="color: #cc7832;">\\</span><span style="color: #6a8759;">full</span><span style="color: #cc7832;">\\</span><span style="color: #6a8759;">'</span> + item[<span style="color: #6a8759;">&quot;title&quot;</span>] + <span style="color: #6a8759;">&quot;.jpg&quot;</span>)</div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #808080;"># item['image_paths'] = self.IMAGES_STORE + '\\full\\' + item[&quot;last_title&quot;]</span></div><div style="background-color:rgb(43, 43, 43);color:rgb(169, 183, 198);font-family:宋体;font-size:7.2pt;"><span style="color: #cc7832;">return</span> item</div><div><br/></div><div>setting里配置中间件信息，done！</div></span>
</div></body></html> 